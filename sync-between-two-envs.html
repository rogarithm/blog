<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="./css/main.css" type="text/css" media="screen" />
	</head>
	<body>
		<div class="site">
			<div class="title">
			</div>
			<h1> 회사-집 작업 동기화하기</h1>
<p>
  재택 근무를 하는 회사에서 일하게 되었다. 재택할 때는 집 컴퓨터를 쓰는데, 회사에서 한 작업을 집 컴퓨터와 동기화하는 게 문제였다. 공동으로 작업하는 프로젝트는 임시 git 브랜치를 만들어서 회사 깃헙에 올려주고 동기화했지만, 혼자 맡아서 작업하는 프로젝트의 경우는 그렇게 하기가 어려웠다.
</p>
<p>
  일일이 동기화하기에는 진행하면서 바뀌거나 건드리는 부분이 많아 이런 부분을 찾아내기가 번거로웠다. 깃헙에 올려두고 동기화하는 방안을 생각했지만, 내 상황에 맞지 않았다.
</p>
<ul>
  <li>회사 깃헙에 올리기는 어려웠다. 내가 하고 있는 작업은 소스가 그리 크지 않고, 나 혼자서 작업하는 프로젝트인 경우도 있었다. 이런 작업이 생길 때마다 깃헙 저장소를 새로 만들면 다른 팀원들이 맥락 따라잡기가 어려울 것 같다는 의견이 개발 회의할 때 나왔다.</li>
  <li>텍스트 파일이나 테스트 용도의 이미지 파일 등 소스 코드 외 파일도 업무에 필요해서 동기화할 필요가 있었지만, 이런 데이터를 회사 깃헙에 올리기에 적당하지 않아 보였다.</li>
  <li>내 개인 계정의 private repo로 올리는 것도 적절하지 않아보였다. 소스 코드든 데이터든 결국 회사 자산이기 때문이다.</li>
</ul>
<p>
  결국 서버를 거치지 않고도 동기화할 수 있는 방법이 필요했다. 그래서 git format-patch로 작업 내역을 패치 파일로 만들어 이메일로 보내고, 상대편 환경에서 받아서 git am으로 적용하는 방식을 떠올렸다. 이때 모든 커밋을 패치 파일로 만들고, git am 적용 시 이미 적용된 패치는 git am --skip으로 넘기는 흐름을 생각했다. 상대편 환경에 없는 패치 파일만 만들려면 각 환경별 마지막 커밋 정보를 관리해야 했는데, 잊을 때가 많았기 때문이다.
</p>
<p>
  위 아이디어를 스크립트로 구현해서 몇 번 써보다가 이전 커밋에서 지웠던 파일이 git am 적용 이후 다시 생성되는 문제를 발견했다. 원인을 파악해보니, 이미 적용된 패치가 중복 적용되어 커밋 기록이 꼬여서 발생한 문제였다.
</p>
<p>
  이 문제를 방지하기 위해, 변경 사항을 적용할 환경에 없는 패치만 필터링하는 로직을 추가했다. git format-patch로 만든 패치 파일에는 커밋 해시가 적혀 있는데, git 커밋 기록에 없는 커밋 해시를 갖는 패치 파일만 찾아서 적용하면 되겠다고 생각했다.
</p>
<p>
  예상과 달리, 아이디어를 구현한 뒤 테스트해보니 패치 필터링이 제대로 되지 않았다. 동기화할 환경이 가지고 있는 변경 사항에 대한 패치 파일도 필터링 결과에 포함되었다. git format-patch로 만든 패치 파일을 적용할 때 git am 명령을 쓰는데, 해당 명령이 동일한 패치 파일을 적용할 때마다 새로운 해시를 갖는 커밋을 생성하기 때문이었다.
</p>
<p>
  결국 내 상황에 패치 파일을 쓰는 방식은 적합하지 않다고 결론내렸다. 패치 파일을 쓰게 되면 동일한 변경사항에 대해 서로 다른 커밋 해시가 생성되어 두 환경 간 커밋 기록이 달라지게 된다. 그러면 커밋 해시가 아닌 다른 기준으로 이미 적용된 커밋인지 확인해야 하고, 확인하는 로직이 깨지는 상황이 생길 수 있어 관리하기가 까다로워 보였다.
</p>
<p>
  가능한 다른 옵션을 알아본 결과, git bundle을 쓰기로 했다. git bundle로 만든 bundle 파일을 상대 환경에 적용하면, 기존 커밋 해시를 그대로 유지하면서 적용된다. 커밋 적용 여부 판별이 용이하고 환경 간 커밋 기록이 일치하기 때문에, 환경 간 작업 동기화라는 목적에는 git bundle이 더 적합하다고 결론내렸다.<br><br><br><br><br><br>
</p>

		</div>
	</body>
</html>
